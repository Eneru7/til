# 事务的概念



* 原子性（ Atomicity ）
* 隔离性（ Isolation ）
* 一致性（ Consistency ）
* 持久性（ Durability ）

这四个词对应的英文单词首字母提取出来就是A 、I 、C 、D ，稍微变换一下顺序可以组成一个完整的英文单词：ACID 。ACID 是英文酸的意思，以后我们提到ACID 这个词儿，大家就应该想到原子性、一致性、隔离性、持久性这几个规则。另外，设计数据库的大叔为了方便起见，把需要保证原子
性、隔离性、一致性和持久性的一个或多个数据库操作称之为一个==事务==（英文名是： transaction ）。

现在知道**事务**是一个抽象的概念，它其实对应着一个或多个数据库操作，设计数据库的大叔根据这些操作所执行的不同阶段把事务大致上划分成了这么几个**状态**：

* **活动的（active）**

  事务对应的数据库操作正在执行过程中时，我们就说该事务处在**活动**的状态。

* **部分提交的（partially committed）**

  当事务中的最后一个操作执行完成，但由于操作都在内存中执行，所造成的影响并没有刷新到磁盘时，我们就说该事务处在**部分提交的**状态。

* **失败的（failed）**

  当事务处在活动的或者部分提交的状态时，可能遇到了某些错误（数据库自身的错误、操作系统错误或者直接断电等）而无法继续执行，或者人为的停止当前事务的执行，我们就说该事务处在**失败**的状态。

* **中止的（aborted）**

  如果事务执行了半截而变为**失败**的状态，比如我们前边唠叨的狗哥向猫爷转账的事务，当狗哥账户的钱被扣除，但是猫爷账户的钱没有增加时遇到了错误，从而当前事务处在了**失败的**状态，那么就需要把已经修改的狗哥账户余额调整为未转账之前的金额，换句话说，就是要**撤销**失败事务对当前数据库造成的影响。书面一点的话，我们把这个撤销的过程称之为**回滚**。当**回滚**操作执行完毕时，也就是数据库恢复到了执行事务之前的状态，我们就说该事务处在了**中止的**状态。

* **提交的（committed）**

  当一个处在**部分提交的**状态的事务将修改过的数据都同步到磁盘上之后，我们就可以说该事务处在了**提交的状态。**

随着事务对应的数据库操作执行到不同阶段，事务的状态也在不断变化，一个基本的状态转换图如下所示：

![image-20221019152732882](https://raw.githubusercontent.com/Eneru7/img/main/img_folder/image-20221019152732882.png)

从图中大家也可以看出了，==只有当事务处于提交的或者中止的状态时，一个事务的生命周期才算是结束了==。对于已经提交的事务来说，该事务对数据库所做的修改将永久生效，对于处于中止状态的事务，该事务对数据库所做的所有修改都会被回滚到没执行该事务之前的状态。





